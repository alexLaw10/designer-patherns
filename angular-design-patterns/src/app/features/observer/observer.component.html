<div class="observer-demo demo-container">
  <div class="demo-header">
    <h2>üëÅÔ∏è Observer Pattern</h2>
    <p>O Observer Pattern permite que objetos sejam notificados automaticamente sobre mudan√ßas de estado.</p>
  </div>
  
  <div class="demo-content">
    <div class="input-section demo-section">
      <h3>üì∞ Publicar Not√≠cia</h3>
      <div class="input-group">
        <input 
          type="text" 
          [(ngModel)]="newNews" 
          placeholder="Digite uma not√≠cia..."
          class="news-input"
          (keyup.enter)="addNews()">
        <button (click)="addNews()" class="btn btn-primary" [disabled]="!newNews.trim()">
          Publicar
        </button>
      </div>
    </div>
    
    <div class="observers-section demo-section">
      <h3>üë• Observadores ({{ observers.length }})</h3>
      <div class="observers-list">
        <div *ngFor="let observer of observers; let i = index" class="observer-item">
          <span class="observer-name">{{ observer.name }}</span>
          <span class="observer-role">{{ getObserverRole(i) }}</span>
          <div class="observer-last">
            <small *ngIf="observer.lastNews; else noNews">
              √öltima: "{{ observer.lastNews }}" ‚Äî {{ observer.lastReceivedAt | date:'shortTime' }}
            </small>
            <ng-template #noNews>
              <small>Nenhuma not√≠cia recebida ainda</small>
            </ng-template>
          </div>
        </div>
      </div>
      <button (click)="addObserver()" class="btn btn-secondary">‚ûï Adicionar Observador</button>
    </div>
    
    <div class="news-section demo-section">
      <h3>üì∞ Not√≠cias Publicadas ({{ news.length }})</h3>
      <div class="news-list">
        <div *ngFor="let newsItem of news; let i = index" class="news-item">
          <div class="news-number">{{ i + 1 }}</div>
          <div class="news-content">{{ newsItem }}</div>
          <div class="news-time">{{ getCurrentTime() }}</div>
        </div>
        <div *ngIf="news.length === 0" class="empty-state">
          Nenhuma not√≠cia publicada ainda
        </div>
      </div>
    </div>
  </div>

  <div class="explanation">
    <h3>üîç Observer Pattern - Conceito e Implementa√ß√£o</h3>
    <div class="explanation-content">
      
      <div class="concept content-card">
        <h4>üìö Conceito</h4>
        <p>O Observer Pattern √© um padr√£o comportamental que define uma depend√™ncia um-para-muitos entre objetos, de modo que quando um objeto muda de estado, todos os seus dependentes s√£o notificados e atualizados automaticamente.</p>
        <p><strong>Problema que resolve:</strong> Como notificar m√∫ltiplos objetos sobre mudan√ßas em outro objeto sem acopl√°-los diretamente?</p>
      </div>
      
      <div class="flow content-card">
        <h4>üîÑ Fluxo de Funcionamento</h4>
        <div class="flow-steps">
          <div class="flow-step">
            <div class="step-number">1</div>
            <div class="step-content">
              <strong>Subject recebe mudan√ßa</strong>
              <p>O objeto observado (Subject) recebe uma mudan√ßa de estado.</p>
            </div>
          </div>
          <div class="flow-step">
            <div class="step-number">2</div>
            <div class="step-content">
              <strong>Subject notifica observers</strong>
              <p>O Subject percorre sua lista de observers e os notifica sobre a mudan√ßa.</p>
            </div>
          </div>
          <div class="flow-step">
            <div class="step-number">3</div>
            <div class="step-content">
              <strong>Observers reagem</strong>
              <p>Cada observer recebe a notifica√ß√£o e executa sua l√≥gica de atualiza√ß√£o.</p>
            </div>
          </div>
          <div class="flow-step">
            <div class="step-number">4</div>
            <div class="step-content">
              <strong>Estado sincronizado</strong>
              <p>Todos os observers ficam sincronizados com o novo estado do Subject.</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="angular-specific content-card">
        <h4>üÖ∞Ô∏è Como Funciona no Angular</h4>
        <p>No Angular, o Observer Pattern √© fundamental e usado em v√°rias situa√ß√µes:</p>
        <ul>
          <li><strong>Data Binding:</strong> Atualiza√ß√£o autom√°tica da UI quando dados mudam</li>
          <li><strong>Change Detection:</strong> Zone.js detecta mudan√ßas e atualiza componentes</li>
          <li><strong>EventEmitter:</strong> Comunica√ß√£o entre componentes pai e filho</li>
          <li><strong>RxJS Observables:</strong> Streams de dados reativos</li>
          <li><strong>NgRx Store:</strong> Gerenciamento de estado global</li>
        </ul>
      </div>
      
      <div class="code-example content-card">
        <h4>üíª C√≥digo do Exemplo</h4>
        <div class="code-block">
          <div class="code-header">
            <div class="traffic-lights">
              <div class="traffic-light close"></div>
              <div class="traffic-light minimize"></div>
              <div class="traffic-light maximize"></div>
            </div>
            <div class="code-title">news-subject.service.ts</div>
          </div>
          <pre><code>// Interface Observer
export interface Observer &#123;
  update(data: any): void;
&#125;

// Interface Subject
export interface Subject &#123;
  addObserver(observer: Observer): void;
  removeObserver(observer: Observer): void;
  notifyObservers(data: any): void;
&#125;

// Subject concreto
@Injectable(&#123;
  providedIn: 'root'
&#125;)
export class NewsSubjectService implements Subject &#123;
  private observers: Observer[] = [];
  private newsList: string[] = [];

  addObserver(observer: Observer): void &#123;
    this.observers.push(observer);
  &#125;

  removeObserver(observer: Observer): void &#123;
    const index = this.observers.indexOf(observer);
    if (index > -1) &#123;
      this.observers.splice(index, 1);
    &#125;
  &#125;

  notifyObservers(news: string): void &#123;
    this.observers.forEach(observer => &#123;
      observer.update(news);
    &#125;);
  &#125;

  addNews(news: string): void &#123;
    this.newsList.push(news);
    this.notifyObservers(news);
  &#125;
&#125;

// Observer concreto
export class NewsObserverService implements Observer &#123;
  constructor(private name: string) &#123;&#125;

  update(news: string): void &#123;
    console.log(this.name + ' recebeu: ' + news);
  &#125;
&#125;</code></pre>
        </div>
      </div>
      
    </div>
  </div>
</div>